<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>More or Less â€” RFT Program 1</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    @keyframes bounce { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-12px)} }
    @keyframes wiggle { 0%,100%{transform:rotate(0)} 25%{transform:rotate(-4deg)} 75%{transform:rotate(4deg)} }
    @keyframes pop { 0%{transform:scale(1)} 50%{transform:scale(1.15)} 100%{transform:scale(1)} }
    @keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-6px)} }
    @keyframes sparkle { 0%,100%{opacity:1} 50%{opacity:0.4} }
    @keyframes grassWave { 0%,100%{transform:skewX(-2deg)} 50%{transform:skewX(2deg)} }
    @keyframes cloudDrift { 0%{transform:translateX(0)} 100%{transform:translateX(60px)} }
    @keyframes celebrate { 0%{transform:scale(1) rotate(0)} 25%{transform:scale(1.2) rotate(-5deg)} 50%{transform:scale(1) rotate(5deg)} 75%{transform:scale(1.1) rotate(-3deg)} 100%{transform:scale(1) rotate(0)} }
    .anim-bounce { animation: bounce 0.5s ease-in-out; }
    .anim-wiggle { animation: wiggle 0.4s ease-in-out; }
    .anim-pop { animation: pop 0.3s ease-in-out; }
    .anim-float { animation: float 3s ease-in-out infinite; }
    .anim-sparkle { animation: sparkle 1.5s ease-in-out infinite; }
    .anim-grass { animation: grassWave 4s ease-in-out infinite; }
    .anim-cloud { animation: cloudDrift 12s ease-in-out infinite alternate; }
    .anim-celebrate { animation: celebrate 0.6s ease-in-out; }
    .fredoka { font-family: 'Fredoka', sans-serif; }
    .nunito { font-family: 'Nunito', sans-serif; }
    .meadow { background: linear-gradient(180deg, #87CEEB 0%, #B0E0FF 40%, #7BC67E 40%, #5DAF5E 100%); }
  
    .frameshift-back {
      position: fixed; top: 12px; left: 12px; z-index: 50;
      background: rgba(255,255,255,0.85); backdrop-filter: blur(8px);
      border: 1px solid rgba(0,0,0,0.1); border-radius: 12px;
      padding: 6px 14px; font-family: 'Fredoka', sans-serif;
      font-size: 13px; font-weight: 600; color: #6366F1;
      text-decoration: none; transition: all 0.2s;
      box-shadow: 1px 2px 6px rgba(0,0,0,0.08);
    }
    .frameshift-back:hover { background: rgba(255,255,255,0.95); transform: scale(1.05); color: #4F46E5; }
  </style>

  <!-- FrameShift Tracker Integration -->
  <script>
    window.FrameShift = {
      STORAGE_KEY: "frameshift_progress",
      load: function() {
        try {
          var raw = localStorage.getItem(this.STORAGE_KEY);
          return raw ? JSON.parse(raw) : { programs: {}, achievements: {}, totalSessions: 0, streak: { current: 0, best: 0, lastDate: null } };
        } catch(e) { return { programs: {}, achievements: {}, totalSessions: 0, streak: { current: 0, best: 0, lastDate: null } }; }
      },
      save: function(data) {
        try { localStorage.setItem(this.STORAGE_KEY, JSON.stringify(data)); } catch(e) {}
      },
      saveSession: function(programId, trainScore, trainMax, testScore, testMax, mastery) {
        var data = this.load();
        if (!data.programs[programId]) {
          data.programs[programId] = { sessions: [], bestScore: { train: 0, test: null }, mastery: false, lastPlayed: null };
        }
        var prog = data.programs[programId];
        var session = { date: new Date().toISOString(), trainScore: trainScore, trainMax: trainMax };
        if (testScore !== undefined && testScore !== null) {
          session.testScore = testScore;
          session.testMax = testMax;
        }
        prog.sessions.push(session);
        prog.lastPlayed = new Date().toISOString();
        if (trainScore > prog.bestScore.train) prog.bestScore.train = trainScore;
        if (testScore !== undefined && testScore !== null && (prog.bestScore.test === null || testScore > prog.bestScore.test)) {
          prog.bestScore.test = testScore;
        }
        if (mastery) prog.mastery = true;
        data.totalSessions++;
        // Streak tracking
        var today = new Date().toISOString().split('T')[0];
        if (data.streak.lastDate) {
          var last = new Date(data.streak.lastDate);
          var diff = Math.floor((new Date(today) - last) / 86400000);
          if (diff === 1) { data.streak.current++; }
          else if (diff > 1) { data.streak.current = 1; }
        } else { data.streak.current = 1; }
        data.streak.lastDate = today;
        if (data.streak.current > data.streak.best) data.streak.best = data.streak.current;
        this.save(data);
        return data;
      }
    };
  </script>

</head>
<body>
  <a href="index.html" class="frameshift-back">â† FrameShift</a>
  <div id="root"></div>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback } = React;

    // â”€â”€ CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Tier definitions â€” only Tier 1 active, others ready
    const TIERS = {
      1: { min: 2, max: 6, minDiff: 2, label: "Tier 1" },
      2: { min: 3, max: 8, minDiff: 2, label: "Tier 2" },
      3: { min: 5, max: 10, minDiff: 1, label: "Tier 3" },
      4: { min: 7, max: 12, minDiff: 1, label: "Tier 4" },
    };
    const MASTERY_THRESHOLD = 8;   // correct out of last 10
    const TRIALS_PER_SESSION = 12;
    const CURRENT_TIER = 1;

    // â”€â”€ ITEM THEMES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Each theme: array of SVG-renderable items with colors
    const THEMES = [
      { name: "stars",       emoji: "â­", color: "#FBBF24", accent: "#F59E0B", shape: "star" },
      { name: "apples",      emoji: "ğŸ", color: "#EF4444", accent: "#DC2626", shape: "circle" },
      { name: "flowers",     emoji: "ğŸŒ¸", color: "#F472B6", accent: "#EC4899", shape: "flower" },
      { name: "fish",        emoji: "ğŸŸ", color: "#38BDF8", accent: "#0EA5E9", shape: "fish" },
      { name: "butterflies", emoji: "ğŸ¦‹", color: "#A78BFA", accent: "#8B5CF6", shape: "butterfly" },
      { name: "leaves",      emoji: "ğŸƒ", color: "#4ADE80", accent: "#22C55E", shape: "leaf" },
    ];

    // â”€â”€ SVG ITEM RENDERER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const ItemSVG = ({ shape, color, accent, size = 40 }) => {
      const s = size;
      if (shape === "star") return (
        <svg width={s} height={s} viewBox="0 0 40 40">
          <polygon points="20,2 25,15 39,15 28,24 32,38 20,30 8,38 12,24 1,15 15,15"
            fill={color} stroke={accent} strokeWidth="1.5"/>
          <polygon points="20,8 23,16 31,16 25,21 27,30 20,25 13,30 15,21 9,16 17,16"
            fill="white" opacity="0.25"/>
        </svg>
      );
      if (shape === "circle") return (
        <svg width={s} height={s} viewBox="0 0 40 40">
          <circle cx="20" cy="22" r="15" fill={color} stroke={accent} strokeWidth="1.5"/>
          <ellipse cx="15" cy="17" rx="5" ry="4" fill="white" opacity="0.3"/>
          <line x1="20" y1="7" x2="20" y2="3" stroke="#65A30D" strokeWidth="2.5" strokeLinecap="round"/>
          <ellipse cx="24" cy="5" rx="4" ry="3" fill="#65A30D" transform="rotate(20 24 5)"/>
        </svg>
      );
      if (shape === "flower") return (
        <svg width={s} height={s} viewBox="0 0 40 40">
          {[0,72,144,216,288].map(a => (
            <ellipse key={a} cx="20" cy="10" rx="7" ry="10" fill={color} stroke={accent} strokeWidth="1"
              transform={`rotate(${a} 20 20)`} opacity="0.9"/>
          ))}
          <circle cx="20" cy="20" r="6" fill="#FBBF24" stroke="#F59E0B" strokeWidth="1"/>
        </svg>
      );
      if (shape === "fish") return (
        <svg width={s} height={s} viewBox="0 0 40 40">
          <ellipse cx="20" cy="20" rx="14" ry="9" fill={color} stroke={accent} strokeWidth="1.5"/>
          <polygon points="34,20 40,12 40,28" fill={color} stroke={accent} strokeWidth="1"/>
          <circle cx="13" cy="18" r="2.5" fill="white"/>
          <circle cx="13" cy="18" r="1.2" fill="#1E293B"/>
          <path d="M18,25 Q22,28 26,25" fill="none" stroke={accent} strokeWidth="1" opacity="0.5"/>
        </svg>
      );
      if (shape === "butterfly") return (
        <svg width={s} height={s} viewBox="0 0 40 40">
          <ellipse cx="13" cy="15" rx="10" ry="8" fill={color} opacity="0.85" transform="rotate(-15 13 15)"/>
          <ellipse cx="27" cy="15" rx="10" ry="8" fill={color} opacity="0.85" transform="rotate(15 27 15)"/>
          <ellipse cx="14" cy="26" rx="7" ry="6" fill={accent} opacity="0.7" transform="rotate(-10 14 26)"/>
          <ellipse cx="26" cy="26" rx="7" ry="6" fill={accent} opacity="0.7" transform="rotate(10 26 26)"/>
          <rect x="19" y="10" width="2" height="20" rx="1" fill="#78350F"/>
          <circle cx="13" cy="15" r="2" fill="white" opacity="0.4"/>
          <circle cx="27" cy="15" r="2" fill="white" opacity="0.4"/>
        </svg>
      );
      // leaf
      return (
        <svg width={s} height={s} viewBox="0 0 40 40">
          <ellipse cx="20" cy="18" rx="12" ry="16" fill={color} stroke={accent} strokeWidth="1.5"
            transform="rotate(15 20 18)"/>
          <path d="M20,4 Q20,20 18,34" fill="none" stroke={accent} strokeWidth="1.5" opacity="0.5"/>
          <path d="M14,12 Q20,16 20,16" fill="none" stroke={accent} strokeWidth="1" opacity="0.4"/>
          <path d="M12,20 Q20,22 20,22" fill="none" stroke={accent} strokeWidth="1" opacity="0.4"/>
        </svg>
      );
    };

    // â”€â”€ SOUNDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const useSound = () => {
      const ctxRef = useRef(null);
      const getCtx = () => {
        if (!ctxRef.current) ctxRef.current = new (window.AudioContext || window.webkitAudioContext)();
        return ctxRef.current;
      };

      const playCorrect = () => {
        const ctx = getCtx(), now = ctx.currentTime;
        // Bright ascending chime â€” meadow bell
        [523, 659, 784].forEach((freq, i) => {
          const osc = ctx.createOscillator(), gain = ctx.createGain();
          osc.connect(gain); gain.connect(ctx.destination);
          osc.frequency.value = freq;
          osc.type = "sine";
          gain.gain.setValueAtTime(0.25, now + i * 0.1);
          gain.gain.exponentialRampToValueAtTime(0.01, now + i * 0.1 + 0.35);
          osc.start(now + i * 0.1); osc.stop(now + i * 0.1 + 0.4);
        });
      };

      const playWrong = () => {
        const ctx = getCtx(), now = ctx.currentTime;
        // Gentle low hum â€” not punishing
        const osc = ctx.createOscillator(), gain = ctx.createGain();
        osc.connect(gain); gain.connect(ctx.destination);
        osc.type = "sine";
        osc.frequency.setValueAtTime(220, now);
        osc.frequency.linearRampToValueAtTime(180, now + 0.3);
        gain.gain.setValueAtTime(0.15, now);
        gain.gain.linearRampToValueAtTime(0.01, now + 0.4);
        osc.start(now); osc.stop(now + 0.5);
      };

      const playComplete = () => {
        const ctx = getCtx(), now = ctx.currentTime;
        // Happy ascending melody
        [392,440,523,659,784].forEach((freq, i) => {
          const osc = ctx.createOscillator(), gain = ctx.createGain();
          osc.connect(gain); gain.connect(ctx.destination);
          osc.frequency.value = freq; osc.type = "triangle";
          gain.gain.setValueAtTime(0.2, now + i * 0.12);
          gain.gain.exponentialRampToValueAtTime(0.01, now + i * 0.12 + 0.3);
          osc.start(now + i * 0.12); osc.stop(now + i * 0.12 + 0.35);
        });
      };

      return { playCorrect, playWrong, playComplete };
    };

    // â”€â”€ TRIAL GENERATOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const generateTrial = (tier) => {
      const cfg = TIERS[tier];
      const theme = THEMES[Math.floor(Math.random() * THEMES.length)];
      const askMore = Math.random() > 0.5;

      let a, b;
      do {
        a = cfg.min + Math.floor(Math.random() * (cfg.max - cfg.min + 1));
        b = cfg.min + Math.floor(Math.random() * (cfg.max - cfg.min + 1));
      } while (Math.abs(a - b) < cfg.minDiff);

      // Which side is correct?
      const correctSide = askMore
        ? (a > b ? "left" : "right")
        : (a < b ? "left" : "right");

      return {
        leftCount: a,
        rightCount: b,
        theme,
        askMore,
        prompt: askMore ? "Which has MORE?" : "Which has LESS?",
        correctSide,
      };
    };

    // â”€â”€ ITEM GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Lay out N items in a natural-feeling cluster
    const ItemCluster = ({ count, theme, animClass, size = 38 }) => {
      // Precompute positions to avoid re-randomizing on re-render
      const positions = useRef(null);
      if (!positions.current || positions.current.count !== count) {
        const cols = Math.min(count, 4);
        const rows = Math.ceil(count / cols);
        const pts = [];
        for (let i = 0; i < count; i++) {
          const row = Math.floor(i / cols);
          const col = i % cols;
          // center the row if it has fewer items
          const itemsInRow = row < rows - 1 ? cols : count - (rows - 1) * cols;
          const offsetX = (cols - itemsInRow) * (size + 4) / 2;
          pts.push({
            x: offsetX + col * (size + 4) + (Math.random() * 4 - 2),
            y: row * (size + 4) + (Math.random() * 4 - 2),
          });
        }
        positions.current = { count, pts };
      }

      const w = Math.min(count, 4) * (size + 4);
      const rows = Math.ceil(count / Math.min(count, 4));
      const h = rows * (size + 4);

      return (
        <div className={animClass || ""} style={{ position: "relative", width: w, height: h, margin: "0 auto" }}>
          {positions.current.pts.map((p, i) => (
            <div key={i} style={{ position: "absolute", left: p.x, top: p.y }}>
              <ItemSVG shape={theme.shape} color={theme.color} accent={theme.accent} size={size} />
            </div>
          ))}
        </div>
      );
    };

    // â”€â”€ CLOUDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const Clouds = () => (
      <div className="absolute inset-0 pointer-events-none overflow-hidden">
        {[
          { left: "5%", top: "4%", scale: 1, delay: "0s" },
          { left: "55%", top: "8%", scale: 0.7, delay: "3s" },
          { left: "80%", top: "2%", scale: 0.5, delay: "6s" },
        ].map((c, i) => (
          <div key={i} className="absolute anim-cloud" style={{ left: c.left, top: c.top, animationDelay: c.delay }}>
            <svg width={100 * c.scale} height={50 * c.scale} viewBox="0 0 100 50">
              <ellipse cx="50" cy="35" rx="45" ry="15" fill="white" opacity="0.7"/>
              <ellipse cx="35" cy="25" rx="25" ry="18" fill="white" opacity="0.8"/>
              <ellipse cx="60" cy="22" rx="22" ry="16" fill="white" opacity="0.75"/>
            </svg>
          </div>
        ))}
      </div>
    );

    // â”€â”€ PROGRESS STARS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const ProgressDots = ({ correct, total, current }) => (
      <div className="flex gap-1.5 flex-wrap justify-center">
        {Array.from({ length: total }).map((_, i) => (
          <div key={i} className={`w-5 h-5 rounded-full border-2 flex items-center justify-center text-xs
            ${i < current
              ? (correct > i ? "bg-green-400 border-green-500" : (i < correct ? "bg-green-400 border-green-500" : "bg-red-300 border-red-400"))
              : (i === current ? "bg-yellow-200 border-yellow-400 anim-pop" : "bg-white bg-opacity-40 border-gray-300")
            }`}
            style={{ fontSize: 10 }}
          >
            {i < current && "âœ“"}
            {i === current && "â†’"}
          </div>
        ))}
      </div>
    );

    // â”€â”€ MAIN GAME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const MoreOrLess = () => {
      const [trial, setTrial] = useState(null);
      const [selected, setSelected] = useState(null);       // "left" | "right" | null
      const [feedback, setFeedback] = useState(null);        // "correct" | "wrong" | null
      const [trialIndex, setTrialIndex] = useState(0);
      const [score, setScore] = useState(0);
      const [sessionDone, setSessionDone] = useState(false);
      const [trialLog, setTrialLog] = useState([]);          // for future tracker API
      const [leftAnim, setLeftAnim] = useState("");
      const [rightAnim, setRightAnim] = useState("");
      const { playCorrect, playWrong, playComplete } = useSound();

      // Generate first trial
      useEffect(() => { setTrial(generateTrial(CURRENT_TIER)); }, []);

      const handleSelect = (side) => {
        if (feedback) return;  // already answered
        setSelected(side);
      };

      const handleSubmit = () => {
        if (!selected || feedback) return;
        const isCorrect = selected === trial.correctSide;

        // Log trial data (future: POST to tracker API)
        const logEntry = {
          trial_number: trialIndex + 1,
          phase: "TRAIN",
          relation_type: "A-B",
          left_count: trial.leftCount,
          right_count: trial.rightCount,
          prompt: trial.prompt,
          participant_response: selected,
          correct_response: trial.correctSide,
          is_correct: isCorrect,
          difficulty_tier: CURRENT_TIER,
          theme: trial.theme.name,
          timestamp: new Date().toISOString(),
        };
        setTrialLog(prev => [...prev, logEntry]);

        if (isCorrect) {
          playCorrect();
          setScore(s => s + 1);
          setFeedback("correct");
          // Animate the correct side
          if (selected === "left") setLeftAnim("anim-celebrate");
          else setRightAnim("anim-celebrate");
        } else {
          playWrong();
          setFeedback("wrong");
          if (selected === "left") setLeftAnim("anim-wiggle");
          else setRightAnim("anim-wiggle");
        }
      };

      const handleNext = () => {
        if (trialIndex + 1 >= TRIALS_PER_SESSION) {
          
            // â”€â”€ FrameShift Tracker Save â”€â”€
            if (window.FrameShift) {
              window.FrameShift.saveSession(
                "p1",
                score || 0,
                12,
                null,
                null,
                (score || 0) >= 8
              );
            }
            setSessionDone(true);
          setTimeout(playComplete, 200);
          return;
        }
        setTrialIndex(i => i + 1);
        setTrial(generateTrial(CURRENT_TIER));
        setSelected(null);
        setFeedback(null);
        setLeftAnim("");
        setRightAnim("");
      };

      const handleRestart = () => {
        setTrialIndex(0);
        setTrial(generateTrial(CURRENT_TIER));
        setSelected(null);
        setFeedback(null);
        setScore(0);
        setSessionDone(false);
        setTrialLog([]);
        setLeftAnim("");
        setRightAnim("");
      };

      if (!trial) return (
        <div className="min-h-screen meadow flex items-center justify-center">
          <div className="text-green-800 text-2xl fredoka">Loading...</div>
        </div>
      );

      // â”€â”€ SESSION COMPLETE SCREEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      if (sessionDone) {
        const pct = Math.round((score / TRIALS_PER_SESSION) * 100);
        const mastered = score >= MASTERY_THRESHOLD;
        return (
          <div className="min-h-screen meadow p-4 sm:p-8 relative overflow-hidden">
            <Clouds />
            <div className="relative max-w-lg mx-auto mt-12">
              <div className="bg-white bg-opacity-90 rounded-3xl p-8 sm:p-12 shadow-xl text-center border-4 border-green-300">
                <div className="text-6xl mb-4" style={{ animation: "bounce 0.6s ease-in-out infinite" }}>
                  {mastered ? "ğŸŒŸ" : pct >= 60 ? "ğŸŒ»" : "ğŸŒ±"}
                </div>
                <h2 className="text-4xl fredoka text-green-800 mb-2">
                  {mastered ? "Amazing!" : pct >= 60 ? "Great job!" : "Keep growing!"}
                </h2>
                <p className="text-green-700 text-xl mb-2 nunito">
                  You got <strong>{score}</strong> out of <strong>{TRIALS_PER_SESSION}</strong> correct!
                </p>
                <div className="w-full bg-green-100 rounded-full h-4 mb-6 overflow-hidden border border-green-300">
                  <div className="h-full rounded-full transition-all duration-700"
                    style={{ width: `${pct}%`, background: mastered ? "linear-gradient(90deg, #4ADE80, #22C55E)" : "linear-gradient(90deg, #FDE68A, #FBBF24)" }}
                  />
                </div>
                {mastered && (
                  <p className="text-green-600 nunito mb-6">
                    ğŸ¯ Mastery reached! Ready for the next phase.
                  </p>
                )}
                <button onClick={handleRestart}
                  className="px-8 py-4 rounded-2xl font-bold text-lg bg-gradient-to-b from-green-400 to-green-600 text-white hover:from-green-300 hover:to-green-500 shadow-lg hover:scale-105 transition-all duration-200 fredoka border-2 border-green-700">
                  ğŸŒ¿ Play Again
                </button>
                <div style={{marginTop: "12px"}}>
                  <a href="index.html" className="inline-block px-6 py-2 rounded-xl nunito text-sm font-semibold text-indigo-500 hover:text-indigo-700 hover:bg-indigo-50 transition-all border border-indigo-200">
                    â† Back to FrameShift
                  </a>
                </div>
              </div>
            </div>
          </div>
        );
      }

      // â”€â”€ MAIN GAME SCREEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const askMore = trial.askMore;

      return (
        <div className="min-h-screen meadow p-4 sm:p-8 relative overflow-hidden">
          <Clouds />

          <div className="relative max-w-2xl mx-auto">
            {/* Header */}
            <div className="text-center mb-4">
              <h1 className="text-4xl sm:text-5xl fredoka text-green-900 drop-shadow-sm mb-1 anim-float">
                ğŸŒ¿ More or Less ğŸŒ¿
              </h1>
              <p className="text-green-700 nunito opacity-80 text-sm">
                Phase 1 Â· {TIERS[CURRENT_TIER].label} Â· Quantity Comparison
              </p>
            </div>

            {/* Progress + Score */}
            <div className="flex items-center justify-between mb-4 px-2">
              <div className="text-green-800 nunito">
                <span className="text-sm opacity-70">Trial</span>
                <span className="ml-1 font-bold text-lg">{trialIndex + 1}/{TRIALS_PER_SESSION}</span>
              </div>
              <ProgressDots correct={score} total={TRIALS_PER_SESSION} current={trialIndex} />
              <div className="text-green-800 nunito text-right">
                <span className="text-sm opacity-70">Score</span>
                <span className="ml-1 font-bold text-lg text-green-600">{score} â­</span>
              </div>
            </div>

            {/* Prompt */}
            <div className={`text-center mb-6 py-3 px-6 rounded-2xl inline-block mx-auto fredoka text-2xl sm:text-3xl font-bold shadow-md border-3
              ${askMore
                ? "bg-blue-100 text-blue-800 border-blue-300"
                : "bg-orange-100 text-orange-800 border-orange-300"
              }`}
              style={{ display: "table", margin: "0 auto 1.5rem auto" }}
            >
              {askMore ? "ğŸ‘† Which has MORE?" : "ğŸ‘‡ Which has LESS?"}
            </div>

            {/* Two groups side by side */}
            <div className="flex gap-4 sm:gap-8 justify-center items-stretch mb-6">
              {/* Left group */}
              <button
                onClick={() => handleSelect("left")}
                disabled={!!feedback}
                className={`flex-1 max-w-[260px] rounded-3xl p-4 sm:p-6 transition-all duration-200 border-4 cursor-pointer
                  ${selected === "left"
                    ? (feedback === "correct" ? "border-green-400 bg-green-50 shadow-lg shadow-green-200" :
                       feedback === "wrong" ? "border-red-300 bg-red-50" :
                       "border-yellow-400 bg-yellow-50 shadow-lg shadow-yellow-200 scale-[1.02]")
                    : (feedback && trial.correctSide === "left"
                       ? "border-green-300 bg-green-50"
                       : "border-white border-opacity-60 bg-white bg-opacity-70 hover:bg-opacity-90 hover:border-green-200 hover:shadow-md")
                  }`}
              >
                <div className={leftAnim} onAnimationEnd={() => setLeftAnim("")}>
                  <ItemCluster count={trial.leftCount} theme={trial.theme} size={38} />
                </div>
                {feedback && trial.correctSide === "left" && (
                  <div className="text-center mt-2 text-green-600 font-bold fredoka text-sm">âœ“ {trial.leftCount}</div>
                )}
              </button>

              {/* Divider */}
              <div className="flex items-center">
                <div className="text-3xl fredoka text-green-800 opacity-40 select-none">or</div>
              </div>

              {/* Right group */}
              <button
                onClick={() => handleSelect("right")}
                disabled={!!feedback}
                className={`flex-1 max-w-[260px] rounded-3xl p-4 sm:p-6 transition-all duration-200 border-4 cursor-pointer
                  ${selected === "right"
                    ? (feedback === "correct" ? "border-green-400 bg-green-50 shadow-lg shadow-green-200" :
                       feedback === "wrong" ? "border-red-300 bg-red-50" :
                       "border-yellow-400 bg-yellow-50 shadow-lg shadow-yellow-200 scale-[1.02]")
                    : (feedback && trial.correctSide === "right"
                       ? "border-green-300 bg-green-50"
                       : "border-white border-opacity-60 bg-white bg-opacity-70 hover:bg-opacity-90 hover:border-green-200 hover:shadow-md")
                  }`}
              >
                <div className={rightAnim} onAnimationEnd={() => setRightAnim("")}>
                  <ItemCluster count={trial.rightCount} theme={trial.theme} size={38} />
                </div>
                {feedback && trial.correctSide === "right" && (
                  <div className="text-center mt-2 text-green-600 font-bold fredoka text-sm">âœ“ {trial.rightCount}</div>
                )}
              </button>
            </div>

            {/* Feedback message */}
            {feedback && (
              <div className={`text-center mb-4 py-3 px-6 rounded-2xl nunito font-bold text-lg mx-auto max-w-md
                ${feedback === "correct" ? "bg-green-100 text-green-800 border-2 border-green-300" : "bg-amber-50 text-amber-800 border-2 border-amber-200"}`}>
                {feedback === "correct"
                  ? ["Great counting! ğŸŒŸ", "That's right! â­", "You got it! ğŸ‰", "Wonderful! ğŸŒ»"][Math.floor(Math.random()*4)]
                  : `Not quite â€” the ${trial.correctSide} group has ${trial.correctSide === "left" ? trial.leftCount : trial.rightCount}. Try the next one!`}
              </div>
            )}

            {/* Action button */}
            <div className="flex justify-center">
              {!feedback ? (
                <button onClick={handleSubmit} disabled={!selected}
                  className={`px-8 py-4 rounded-2xl font-bold text-lg transition-all duration-200 fredoka
                    ${!selected
                      ? "bg-gray-300 text-gray-500 cursor-not-allowed"
                      : "bg-gradient-to-b from-green-400 to-green-600 text-white hover:from-green-300 hover:to-green-500 shadow-lg hover:scale-105 border-2 border-green-700"
                    }`}>
                  ğŸŒ± Check!
                </button>
              ) : (
                <button onClick={handleNext}
                  className="px-8 py-4 rounded-2xl font-bold text-lg bg-gradient-to-b from-blue-400 to-blue-600 text-white hover:from-blue-300 hover:to-blue-500 shadow-lg hover:scale-105 transition-all duration-200 fredoka border-2 border-blue-700">
                  {trialIndex + 1 < TRIALS_PER_SESSION ? "ğŸŒ¿ Next â†’" : "ğŸŒŸ See Results!"}
                </button>
              )}
            </div>

            {/* Footer */}
            <div className="text-center mt-8 text-green-700 opacity-40 text-xs nunito">
              RFT Program 1 Â· More or Less Â· Syntopic Systems
            </div>
          </div>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById("root")).render(<MoreOrLess />);
  </script>
</body>
</html>
