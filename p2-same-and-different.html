<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Same &amp; Different â€” RFT Program 2</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    @keyframes pop { 0%{transform:scale(1)} 50%{transform:scale(1.12)} 100%{transform:scale(1)} }
    @keyframes wiggle { 0%,100%{transform:rotate(0)} 25%{transform:rotate(-5deg)} 75%{transform:rotate(5deg)} }
    @keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-6px)} }
    @keyframes celebrate { 0%{transform:scale(1) rotate(0)} 25%{transform:scale(1.15) rotate(-4deg)} 50%{transform:scale(1.05) rotate(3deg)} 100%{transform:scale(1) rotate(0)} }
    @keyframes slideUp { 0%{opacity:0;transform:translateY(16px)} 100%{opacity:1;transform:translateY(0)} }
    @keyframes pulse { 0%,100%{box-shadow:0 0 0 0 rgba(251,191,36,0.4)} 50%{box-shadow:0 0 0 12px rgba(251,191,36,0)} }
    .anim-pop { animation: pop 0.3s ease-in-out; }
    .anim-wiggle { animation: wiggle 0.4s ease-in-out; }
    .anim-float { animation: float 3s ease-in-out infinite; }
    .anim-celebrate { animation: celebrate 0.5s ease-in-out; }
    .anim-slideup { animation: slideUp 0.3s ease-out; }
    .anim-pulse { animation: pulse 1.5s ease-in-out infinite; }
    .fredoka { font-family: 'Fredoka', sans-serif; }
    .nunito { font-family: 'Nunito', sans-serif; }
    .cork {
      background: linear-gradient(135deg, #D4A574 0%, #C4956A 30%, #D9B07E 60%, #C89B6B 100%);
    }
    .card-shadow { box-shadow: 2px 4px 12px rgba(0,0,0,0.18), 0 1px 3px rgba(0,0,0,0.12); }
    .pin-shadow { filter: drop-shadow(1px 2px 2px rgba(0,0,0,0.3)); }
  
    .frameshift-back {
      position: fixed; top: 12px; left: 12px; z-index: 50;
      background: rgba(255,255,255,0.85); backdrop-filter: blur(8px);
      border: 1px solid rgba(0,0,0,0.1); border-radius: 12px;
      padding: 6px 14px; font-family: 'Fredoka', sans-serif;
      font-size: 13px; font-weight: 600; color: #6366F1;
      text-decoration: none; transition: all 0.2s;
      box-shadow: 1px 2px 6px rgba(0,0,0,0.08);
    }
    .frameshift-back:hover { background: rgba(255,255,255,0.95); transform: scale(1.05); color: #4F46E5; }
  </style>

  <!-- FrameShift Tracker Integration -->
  <script>
    window.FrameShift = {
      STORAGE_KEY: "frameshift_progress",
      load: function() {
        try {
          var raw = localStorage.getItem(this.STORAGE_KEY);
          return raw ? JSON.parse(raw) : { programs: {}, achievements: {}, totalSessions: 0, streak: { current: 0, best: 0, lastDate: null } };
        } catch(e) { return { programs: {}, achievements: {}, totalSessions: 0, streak: { current: 0, best: 0, lastDate: null } }; }
      },
      save: function(data) {
        try { localStorage.setItem(this.STORAGE_KEY, JSON.stringify(data)); } catch(e) {}
      },
      saveSession: function(programId, trainScore, trainMax, testScore, testMax, mastery) {
        var data = this.load();
        if (!data.programs[programId]) {
          data.programs[programId] = { sessions: [], bestScore: { train: 0, test: null }, mastery: false, lastPlayed: null };
        }
        var prog = data.programs[programId];
        var session = { date: new Date().toISOString(), trainScore: trainScore, trainMax: trainMax };
        if (testScore !== undefined && testScore !== null) {
          session.testScore = testScore;
          session.testMax = testMax;
        }
        prog.sessions.push(session);
        prog.lastPlayed = new Date().toISOString();
        if (trainScore > prog.bestScore.train) prog.bestScore.train = trainScore;
        if (testScore !== undefined && testScore !== null && (prog.bestScore.test === null || testScore > prog.bestScore.test)) {
          prog.bestScore.test = testScore;
        }
        if (mastery) prog.mastery = true;
        data.totalSessions++;
        // Streak tracking
        var today = new Date().toISOString().split('T')[0];
        if (data.streak.lastDate) {
          var last = new Date(data.streak.lastDate);
          var diff = Math.floor((new Date(today) - last) / 86400000);
          if (diff === 1) { data.streak.current++; }
          else if (diff > 1) { data.streak.current = 1; }
        } else { data.streak.current = 1; }
        data.streak.lastDate = today;
        if (data.streak.current > data.streak.best) data.streak.best = data.streak.current;
        this.save(data);
        return data;
      }
    };
  </script>

</head>
<body>
  <a href="index.html" class="frameshift-back">â† FrameShift</a>
  <div id="root"></div>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback } = React;

    // â”€â”€ CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const TRIALS_PER_SESSION = 12;
    const MASTERY_THRESHOLD = 9; // out of 12
    const CURRENT_PHASE = 1;     // 1=TRAIN, 2=TEST mutual entailment, 3=TEST generalization

    // â”€â”€ OpenMoji helper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Returns URL for an OpenMoji SVG by Unicode codepoint
    const emojiURL = (code) =>
      `https://openmoji.org/data/color/svg/${code}.svg`;

    // â”€â”€ STIMULUS TRIADS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Each triad: { anchor, similar, different }
    // anchor = the reference word
    // similar = same semantic class (the "same" item)
    // different = different class (the "different" item)
    //
    // Phase 1 TRAIN: Show anchor word, display similar+different as cards, ask "Which is DIFFERENT?"
    // Phase 2 TEST:  Anchor becomes a previously-non-anchor item (mutual entailment, no feedback)
    // Phase 3 TEST:  "Which is SAME?" â€” never trained, must emerge

    const TRIADS = {
      1: [ // Tier 1: maximally different categories
        {
          anchor:    { label: "Ball",      emoji: "26BD", word: "Ball" },
          similar:   { label: "Marble",    emoji: "1F52E", word: "Marble" },
          different: { label: "Frog",      emoji: "1F438", word: "Frog" },
        },
        {
          anchor:    { label: "Cat",       emoji: "1F431", word: "Cat" },
          similar:   { label: "Dog",       emoji: "1F436", word: "Dog" },
          different: { label: "Banana",    emoji: "1F34C", word: "Banana" },
        },
        {
          anchor:    { label: "Car",       emoji: "1F697", word: "Car" },
          similar:   { label: "Bus",       emoji: "1F68C", word: "Bus" },
          different: { label: "Flower",    emoji: "1F338", word: "Flower" },
        },
        {
          anchor:    { label: "Apple",     emoji: "1F34E", word: "Apple" },
          similar:   { label: "Cherry",    emoji: "1F352", word: "Cherry" },
          different: { label: "Hat",       emoji: "1F3A9", word: "Hat" },
        },
        {
          anchor:    { label: "Horse",     emoji: "1F40E", word: "Horse" },
          similar:   { label: "Cow",       emoji: "1F404", word: "Cow" },
          different: { label: "Book",      emoji: "1F4D6", word: "Book" },
        },
        {
          anchor:    { label: "Sun",       emoji: "2600",  word: "Sun" },
          similar:   { label: "Star",      emoji: "2B50",  word: "Star" },
          different: { label: "Fish",      emoji: "1F41F", word: "Fish" },
        },
        {
          anchor:    { label: "Shirt",     emoji: "1F455", word: "Shirt" },
          similar:   { label: "Dress",     emoji: "1F457", word: "Dress" },
          different: { label: "Tree",      emoji: "1F333", word: "Tree" },
        },
        {
          anchor:    { label: "Guitar",    emoji: "1F3B8", word: "Guitar" },
          similar:   { label: "Drum",      emoji: "1FA98", word: "Drum" },
          different: { label: "Egg",       emoji: "1F95A", word: "Egg" },
        },
        {
          anchor:    { label: "Airplane",  emoji: "2708",  word: "Airplane" },
          similar:   { label: "Rocket",    emoji: "1F680", word: "Rocket" },
          different: { label: "Cookie",    emoji: "1F36A", word: "Cookie" },
        },
        {
          anchor:    { label: "House",     emoji: "1F3E0", word: "House" },
          similar:   { label: "Castle",    emoji: "1F3F0", word: "Castle" },
          different: { label: "Butterfly", emoji: "1F98B", word: "Butterfly" },
        },
        {
          anchor:    { label: "Pencil",    emoji: "270F",  word: "Pencil" },
          similar:   { label: "Crayon",    emoji: "1F58D", word: "Crayon" },
          different: { label: "Elephant",  emoji: "1F418", word: "Elephant" },
        },
        {
          anchor:    { label: "Boat",      emoji: "26F5",  word: "Boat" },
          similar:   { label: "Ship",      emoji: "1F6A2", word: "Ship" },
          different: { label: "Pizza",     emoji: "1F355", word: "Pizza" },
        },
        {
          anchor:    { label: "Lion",      emoji: "1F981", word: "Lion" },
          similar:   { label: "Tiger",     emoji: "1F42F", word: "Tiger" },
          different: { label: "Chair",     emoji: "1FA91", word: "Chair" },
        },
        {
          anchor:    { label: "Moon",      emoji: "1F319", word: "Moon" },
          similar:   { label: "Star",      emoji: "2B50",  word: "Star" },
          different: { label: "Rabbit",    emoji: "1F430", word: "Rabbit" },
        },
      ],
      // Tiers 2-4 ready to populate
      2: [],
      3: [],
      4: [],
    };

    // â”€â”€ SOUNDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const useSound = () => {
      const ctxRef = useRef(null);
      const getCtx = () => {
        if (!ctxRef.current) ctxRef.current = new (window.AudioContext || window.webkitAudioContext)();
        return ctxRef.current;
      };

      const playCorrect = () => {
        const ctx = getCtx(), now = ctx.currentTime;
        // Card flip + chime: two quick bright tones
        [660, 880].forEach((freq, i) => {
          const osc = ctx.createOscillator(), gain = ctx.createGain();
          osc.connect(gain); gain.connect(ctx.destination);
          osc.frequency.value = freq; osc.type = "sine";
          gain.gain.setValueAtTime(0.22, now + i * 0.12);
          gain.gain.exponentialRampToValueAtTime(0.01, now + i * 0.12 + 0.3);
          osc.start(now + i * 0.12); osc.stop(now + i * 0.12 + 0.35);
        });
      };

      const playWrong = () => {
        const ctx = getCtx(), now = ctx.currentTime;
        const osc = ctx.createOscillator(), gain = ctx.createGain();
        osc.connect(gain); gain.connect(ctx.destination);
        osc.type = "sine";
        osc.frequency.setValueAtTime(250, now);
        osc.frequency.linearRampToValueAtTime(200, now + 0.25);
        gain.gain.setValueAtTime(0.12, now);
        gain.gain.linearRampToValueAtTime(0.01, now + 0.35);
        osc.start(now); osc.stop(now + 0.4);
      };

      const playComplete = () => {
        const ctx = getCtx(), now = ctx.currentTime;
        [392, 494, 587, 659, 784].forEach((freq, i) => {
          const osc = ctx.createOscillator(), gain = ctx.createGain();
          osc.connect(gain); gain.connect(ctx.destination);
          osc.frequency.value = freq; osc.type = "triangle";
          gain.gain.setValueAtTime(0.2, now + i * 0.11);
          gain.gain.exponentialRampToValueAtTime(0.01, now + i * 0.11 + 0.3);
          osc.start(now + i * 0.11); osc.stop(now + i * 0.11 + 0.35);
        });
      };

      // Simple speech synthesis for anchor word
      const speakWord = (word) => {
        if ('speechSynthesis' in window) {
          const u = new SpeechSynthesisUtterance(word);
          u.rate = 0.85; u.pitch = 1.1;
          window.speechSynthesis.speak(u);
        }
      };

      return { playCorrect, playWrong, playComplete, speakWord };
    };

    // â”€â”€ PUSHPIN SVG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const Pushpin = ({ color = "#EF4444" }) => (
      <svg width="20" height="28" viewBox="0 0 20 28" className="pin-shadow">
        <circle cx="10" cy="8" r="7" fill={color} stroke="#00000022" strokeWidth="1"/>
        <ellipse cx="8" cy="6" rx="3" ry="2" fill="white" opacity="0.35"/>
        <rect x="9" y="14" width="2" height="12" rx="1" fill="#94A3B8"/>
        <rect x="8.5" y="25" width="3" height="3" rx="1.5" fill="#64748B"/>
      </svg>
    );

    // â”€â”€ ITEM CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const ItemCard = ({ item, onClick, selected, feedback, isCorrect, disabled }) => {
      let borderClass = "border-amber-200";
      let bgClass = "bg-amber-50";
      let animClass = "";

      if (selected && feedback === "correct") {
        borderClass = "border-green-400";
        bgClass = "bg-green-50";
        animClass = "anim-celebrate";
      } else if (selected && feedback === "wrong") {
        borderClass = "border-red-300";
        bgClass = "bg-red-50";
        animClass = "anim-wiggle";
      } else if (!selected && feedback && isCorrect) {
        // Highlight the correct one they missed
        borderClass = "border-green-300";
        bgClass = "bg-green-50";
      } else if (selected && !feedback) {
        borderClass = "border-yellow-400";
        bgClass = "bg-yellow-50";
        animClass = "anim-pulse";
      }

      return (
        <button
          onClick={onClick}
          disabled={disabled}
          className={`relative rounded-2xl border-4 ${borderClass} ${bgClass} card-shadow
            p-4 sm:p-6 transition-all duration-200 ${!disabled ? "hover:scale-[1.03] hover:shadow-xl cursor-pointer" : "cursor-default"}
            flex flex-col items-center gap-2 min-w-[130px] sm:min-w-[160px]`}
        >
          {/* Pushpin at top */}
          <div className="absolute -top-3 left-1/2 -translate-x-1/2">
            <Pushpin color={selected ? "#FBBF24" : "#94A3B8"} />
          </div>

          <div className={animClass} onAnimationEnd={(e) => e.currentTarget.className = ""}>
            <img
              src={emojiURL(item.emoji)}
              alt={item.label}
              width="80"
              height="80"
              style={{ width: 80, height: 80 }}
              draggable={false}
            />
          </div>
          <span className="fredoka text-amber-900 text-lg font-semibold">{item.label}</span>

          {/* Correct/wrong indicator */}
          {feedback && isCorrect && (
            <span className="absolute -bottom-2 -right-2 bg-green-500 text-white rounded-full w-7 h-7 flex items-center justify-center text-sm font-bold shadow">âœ“</span>
          )}
          {selected && feedback === "wrong" && (
            <span className="absolute -bottom-2 -right-2 bg-red-400 text-white rounded-full w-7 h-7 flex items-center justify-center text-sm font-bold shadow">âœ—</span>
          )}
        </button>
      );
    };

    // â”€â”€ TRIAL GENERATOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const generateTrials = (tier, count) => {
      const pool = [...TRIADS[tier]];
      // Shuffle
      for (let i = pool.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [pool[i], pool[j]] = [pool[j], pool[i]];
      }

      const trials = [];
      for (let i = 0; i < count; i++) {
        const triad = pool[i % pool.length];
        // Randomize card positions: similar and different in random order
        const swapped = Math.random() > 0.5;
        trials.push({
          anchor: triad.anchor,
          cards: swapped
            ? [triad.different, triad.similar]
            : [triad.similar, triad.different],
          correctIndex: swapped ? 0 : 1,
          triad,
        });
      }
      return trials;
    };

    // â”€â”€ CORK TEXTURE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const CorkTexture = () => (
      <div className="absolute inset-0 pointer-events-none opacity-[0.08]"
        style={{
          backgroundImage: `url("data:image/svg+xml,%3Csvg viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='60' height='60' filter='url(%23n)'/%3E%3C/svg%3E")`,
        }}
      />
    );

    // â”€â”€ PROGRESS BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const ProgressBar = ({ current, total, score }) => (
      <div className="flex items-center gap-3 mb-4 px-1">
        <div className="flex-1">
          <div className="flex justify-between text-xs nunito text-amber-800 opacity-70 mb-1">
            <span>Trial {current + 1} of {total}</span>
            <span>{score} correct</span>
          </div>
          <div className="w-full bg-amber-200 bg-opacity-50 rounded-full h-3 overflow-hidden border border-amber-300">
            <div className="h-full rounded-full transition-all duration-500 bg-gradient-to-r from-amber-400 to-yellow-400"
              style={{ width: `${((current) / total) * 100}%` }} />
          </div>
        </div>
      </div>
    );

    // â”€â”€ MAIN GAME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const SameAndDifferent = () => {
      const [trials, setTrials] = useState([]);
      const [trialIndex, setTrialIndex] = useState(0);
      const [selected, setSelected] = useState(null);       // card index (0 or 1)
      const [feedback, setFeedback] = useState(null);        // "correct" | "wrong" | null
      const [score, setScore] = useState(0);
      const [sessionDone, setSessionDone] = useState(false);
      const [trialLog, setTrialLog] = useState([]);
      const { playCorrect, playWrong, playComplete, speakWord } = useSound();
      const spokenRef = useRef(false);

      // Generate trials on mount
      useEffect(() => {
        setTrials(generateTrials(1, TRIALS_PER_SESSION));
      }, []);

      // Speak the anchor word when a new trial loads
      useEffect(() => {
        if (trials.length > 0 && !spokenRef.current) {
          const timer = setTimeout(() => speakWord(trials[trialIndex].anchor.word), 400);
          spokenRef.current = true;
          return () => clearTimeout(timer);
        }
      }, [trialIndex, trials]);

      const handleSelect = (index) => {
        if (feedback !== null) return;
        setSelected(index);
      };

      const handleSubmit = () => {
        if (selected === null || feedback !== null) return;
        const trial = trials[trialIndex];
        const isCorrect = selected === trial.correctIndex;

        // Log
        setTrialLog(prev => [...prev, {
          trial_number: trialIndex + 1,
          phase: CURRENT_PHASE === 1 ? "TRAIN" : "TEST",
          relation_type: CURRENT_PHASE === 1 ? "A-B/C" : (CURRENT_PHASE === 2 ? "C-A/B" : "Y-Z"),
          anchor: trial.anchor.label,
          cards: trial.cards.map(c => c.label),
          participant_response: trial.cards[selected].label,
          correct_response: trial.cards[trial.correctIndex].label,
          is_correct: isCorrect,
          difficulty_tier: 1,
          timestamp: new Date().toISOString(),
        }]);

        if (isCorrect) {
          playCorrect();
          setScore(s => s + 1);
          setFeedback("correct");
        } else {
          playWrong();
          setFeedback("wrong");
        }
      };

      const handleNext = () => {
        if (trialIndex + 1 >= TRIALS_PER_SESSION) {
          
            // â”€â”€ FrameShift Tracker Save â”€â”€
            if (window.FrameShift) {
              window.FrameShift.saveSession(
                "p2",
                score || 0,
                12,
                null,
                null,
                (score || 0) >= 9
              );
            }
            setSessionDone(true);
          setTimeout(playComplete, 200);
          return;
        }
        spokenRef.current = false;
        setTrialIndex(i => i + 1);
        setSelected(null);
        setFeedback(null);
      };

      const handleRestart = () => {
        setTrials(generateTrials(1, TRIALS_PER_SESSION));
        setTrialIndex(0);
        setSelected(null);
        setFeedback(null);
        setScore(0);
        setSessionDone(false);
        setTrialLog([]);
        spokenRef.current = false;
      };

      if (trials.length === 0) return (
        <div className="min-h-screen cork flex items-center justify-center">
          <div className="text-amber-900 text-2xl fredoka">Setting up the board...</div>
        </div>
      );

      // â”€â”€ SESSION COMPLETE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      if (sessionDone) {
        const pct = Math.round((score / TRIALS_PER_SESSION) * 100);
        const mastered = score >= MASTERY_THRESHOLD;
        return (
          <div className="min-h-screen cork p-4 sm:p-8 relative overflow-hidden">
            <CorkTexture />
            <div className="relative max-w-lg mx-auto mt-12">
              <div className="bg-white bg-opacity-95 rounded-3xl p-8 sm:p-12 card-shadow text-center border-4 border-amber-300">
                <div className="text-6xl mb-4" style={{ animation: "float 3s ease-in-out infinite" }}>
                  {mastered ? "ğŸ†" : pct >= 60 ? "ğŸ‘" : "ğŸ’ª"}
                </div>
                <h2 className="text-4xl fredoka text-amber-800 mb-2">
                  {mastered ? "Excellent!" : pct >= 60 ? "Good work!" : "Keep practicing!"}
                </h2>
                <p className="text-amber-700 text-xl mb-2 nunito">
                  You got <strong>{score}</strong> out of <strong>{TRIALS_PER_SESSION}</strong> correct!
                </p>
                <div className="w-full bg-amber-100 rounded-full h-4 mb-6 overflow-hidden border border-amber-300">
                  <div className="h-full rounded-full transition-all duration-700"
                    style={{ width: `${pct}%`, background: mastered ? "linear-gradient(90deg, #FBBF24, #F59E0B)" : "linear-gradient(90deg, #FDE68A, #FBBF24)" }} />
                </div>
                {mastered && (
                  <p className="text-amber-600 nunito mb-6">
                    ğŸ¯ Mastery reached! Ready for the test phase.
                  </p>
                )}
                <button onClick={handleRestart}
                  className="px-8 py-4 rounded-2xl font-bold text-lg bg-gradient-to-b from-amber-400 to-amber-600 text-white hover:from-amber-300 hover:to-amber-500 shadow-lg hover:scale-105 transition-all duration-200 fredoka border-2 border-amber-700">
                  ğŸ“‹ Play Again
                </button>
                <div style={{marginTop: "12px"}}>
                  <a href="index.html" className="inline-block px-6 py-2 rounded-xl nunito text-sm font-semibold text-indigo-500 hover:text-indigo-700 hover:bg-indigo-50 transition-all border border-indigo-200">
                    â† Back to FrameShift
                  </a>
                </div>
              </div>
            </div>
          </div>
        );
      }

      // â”€â”€ MAIN TRIAL SCREEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const trial = trials[trialIndex];

      return (
        <div className="min-h-screen cork p-4 sm:p-8 relative overflow-hidden">
          <CorkTexture />

          <div className="relative max-w-2xl mx-auto">
            {/* Header */}
            <div className="text-center mb-3">
              <h1 className="text-4xl sm:text-5xl fredoka text-amber-900 drop-shadow-sm mb-1 anim-float">
                Same &amp; Different
              </h1>
              <p className="text-amber-800 nunito opacity-60 text-sm">
                Phase 1 Â· Tier 1 Â· Which Is Different?
              </p>
            </div>

            <ProgressBar current={trialIndex} total={TRIALS_PER_SESSION} score={score} />

            {/* Anchor word */}
            <div className="text-center mb-6 anim-slideup">
              <div className="inline-flex flex-col items-center gap-2 bg-white bg-opacity-90 rounded-2xl px-8 py-4 card-shadow border-2 border-amber-200">
                <button
                  onClick={() => speakWord(trial.anchor.word)}
                  className="flex items-center gap-3 hover:opacity-80 transition-opacity"
                  title="Tap to hear the word"
                >
                  <img src={emojiURL(trial.anchor.emoji)} alt={trial.anchor.label}
                    width="56" height="56" style={{ width: 56, height: 56 }} draggable={false} />
                  <span className="fredoka text-3xl text-amber-900 font-bold">{trial.anchor.word}</span>
                  <span className="text-2xl opacity-50">ğŸ”Š</span>
                </button>
              </div>
            </div>

            {/* Prompt */}
            <div className="text-center mb-6">
              <span className="inline-block bg-red-100 text-red-800 px-6 py-2 rounded-2xl fredoka text-xl sm:text-2xl font-bold border-2 border-red-200 card-shadow">
                ğŸ” Which is DIFFERENT from {trial.anchor.word}?
              </span>
            </div>

            {/* Two cards */}
            <div className="flex gap-6 sm:gap-10 justify-center items-start mb-6">
              {trial.cards.map((card, idx) => (
                <ItemCard
                  key={idx}
                  item={card}
                  onClick={() => handleSelect(idx)}
                  selected={selected === idx}
                  feedback={feedback}
                  isCorrect={idx === trial.correctIndex}
                  disabled={feedback !== null}
                />
              ))}
            </div>

            {/* Feedback */}
            {feedback && (
              <div className={`text-center mb-4 py-3 px-6 rounded-2xl nunito font-bold text-lg mx-auto max-w-md anim-slideup
                ${feedback === "correct" ? "bg-green-100 text-green-800 border-2 border-green-300" : "bg-amber-50 text-amber-800 border-2 border-amber-200"}`}>
                {feedback === "correct"
                  ? ["That's right! ğŸ‰", "Great eye! â­", "You spotted it! ğŸ‘", "Correct! ğŸ†"][Math.floor(Math.random()*4)]
                  : `Not quite â€” ${trial.cards[trial.correctIndex].label} is the different one. ${trial.anchor.label} and ${trial.cards[1 - trial.correctIndex].label} go together!`}
              </div>
            )}

            {/* Action button */}
            <div className="flex justify-center">
              {!feedback ? (
                <button onClick={handleSubmit} disabled={selected === null}
                  className={`px-8 py-4 rounded-2xl font-bold text-lg transition-all duration-200 fredoka
                    ${selected === null
                      ? "bg-gray-300 text-gray-500 cursor-not-allowed"
                      : "bg-gradient-to-b from-amber-400 to-amber-600 text-white hover:from-amber-300 hover:to-amber-500 shadow-lg hover:scale-105 border-2 border-amber-700"}`}>
                  ğŸ“Œ Check!
                </button>
              ) : (
                <button onClick={handleNext}
                  className="px-8 py-4 rounded-2xl font-bold text-lg bg-gradient-to-b from-blue-400 to-blue-600 text-white hover:from-blue-300 hover:to-blue-500 shadow-lg hover:scale-105 transition-all duration-200 fredoka border-2 border-blue-700">
                  {trialIndex + 1 < TRIALS_PER_SESSION ? "ğŸ“‹ Next â†’" : "ğŸ† See Results!"}
                </button>
              )}
            </div>

            {/* Footer */}
            <div className="text-center mt-8 text-amber-800 opacity-30 text-xs nunito">
              RFT Program 2 Â· Same &amp; Different Â· Syntopic Systems
              <br/>
              Emoji by <a href="https://openmoji.org" target="_blank" rel="noopener" className="underline">OpenMoji</a> (CC BY-SA 4.0)
            </div>
          </div>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById("root")).render(<SameAndDifferent />);
  </script>
</body>
</html>
